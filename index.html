<!DOCTYPE html>
<html>
<head>
  <title>Live Health Dashboard</title>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: top;
      height: 100vh;
    }

    #chart-container {
      width: 90%;
      height: 300px;
      margin-top: 20px;
    }

    #values {
      margin-top: 20px;
      font-size: 1.8em;
      text-align: center;
    }

    #values span {
      display: inline-block;
      margin: 0 30px;
      font-weight: bold;
    }

    h2 {
      margin: 0;
      font-size: 1.5em;
      color: #333;
    }
  </style>
</head>
<body>

<h2>ðŸ”´ LIVE HEART RATE MONITOR</h2>

<div id="chart-container">
  <canvas id="chart"></canvas>
</div>

<div id="values">
  <span>BPM: <span id="bpm">--</span></span>
  <span>SpOâ‚‚: <span id="spo2">--</span></span>
</div>

<script>
/* ===== Firebase Config ===== */
const firebaseConfig = {
  apiKey: "AIzaSyB8yZZHmjx4ExnkeV_V5iieSK5tSdY_Uqo",
  databaseURL: "https://bpmhealth-813a8-default-rtdb.firebaseio.com/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== DOM Elements ===== */
const bpmEl = document.getElementById("bpm");
const spo2El = document.getElementById("spo2");
const ctx = document.getElementById("chart").getContext("2d");

/* ===== Chart.js - Live Line ===== */
const chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "Heart Rate (BPM)",
      data: [],
      borderColor: "#d32f2f",
      borderWidth: 2,
      pointRadius: 0,
      fill: false,
      tension: 0.2
    }]
  },
  options: {
    responsive: true,
    animation: false,
    maintainAspectRatio: false,
    scales: {
      x: {
        display: false
      },
      y: {
        min: 40,
        max: 180
      }
    },
    plugins: {
      legend: { display: false }
    }
  }
});

/* ===== LIVE DATA ===== */
db.ref("Live").on("value", snapshot => {
  const data = snapshot.val();
  if (!data) return;

  const bpm = data.BPM ?? 0;
  const spo2 = data.SpO2 ?? 0;

  bpmEl.innerText = bpm;
  spo2El.innerText = spo2 + "%";

  const t = new Date().toLocaleTimeString();

  if (chart.data.labels.length > 50) { // keep last 50 points
    chart.data.labels.shift();
    chart.data.datasets[0].data.shift();
  }

  chart.data.labels.push(t);
  chart.data.datasets[0].data.push(bpm);
  chart.update();
});
</script>

</body>
</html>

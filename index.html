<!DOCTYPE html>
<html>
<head>
<title>Heart Monitor Dashboard</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap');

body {
  font-family: Arial, sans-serif;
  background-color: #121212;
  color: #fff;
  display: flex;
  flex-direction: row;
  margin: 0;
  padding: 20px;
  min-height: 100vh;
}

.chart-panel {
  width: 350px;
  background: #1e1e1e;
  padding: 20px;
  border-radius: 12px;
  border: 2px solid #444;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-right: 20px;
}
#chartContainer { width: 100%; }

button { 
  background-color: #ff4081; 
  color: white; 
  border: none; 
  padding: 10px 15px; 
  border-radius: 6px; 
  cursor: pointer; 
  margin-bottom: 15px;
  font-weight: bold;
}
button:hover { background-color: #ff79b0; }

.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 { color: #ff4081; margin-bottom: 20px; text-align: center; }

.gauges {
  display: flex;
  gap: 40px;
}

.gauge-container {
  position: relative;
  width: 200px;
  height: 200px;
}

.gauge-bg {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: #1e1e1e;
  border: 12px solid #444;
}

.arc {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  clip: rect(0px, 200px, 200px, 100px);
}

.arc-fill {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border: 12px solid #00e676;
  clip: rect(0px, 100px, 200px, 0px);
  transform: rotate(-120deg);
  transform-origin: 50% 50%;
  transition: transform 0.3s ease-out;
}

.needle {
  position: absolute;
  width: 4px;
  height: 90px;
  background: #ff4081;
  top: 50%;
  left: 50%;
  transform-origin: bottom center;
  border-radius: 2px;
  transform: rotate(-120deg);
  transition: transform 0.3s ease-out;
}

.gauge-value {
  position: absolute;
  width: 100%;
  text-align: center;
  top: 50%;
  transform: translateY(-50%);
  font-size: 2em;
  font-family: 'Orbitron', monospace;
}

.gauge-status {
  position: absolute;
  width: 100%;
  text-align: center;
  bottom: 20px;
  font-size: 1em;
}

.gauge-time {
  position: absolute;
  width: 100%;
  text-align: center;
  bottom: 5px;
  font-size: 0.8em;
  color: #aaa;
}

.warning {
  color: #ff4444; 
  font-size: 1em; 
  margin-top: 20px; 
  animation: blink 1s infinite;
  text-align: center;
}
@keyframes blink { 0%,50%,100%{opacity:1;}25%,75%{opacity:0;} }

.low { color: #ff4444; } 
.normal { color: #00e676; } 
.high { color: #ffab00; }

</style>
</head>
<body>

<div class="chart-panel">
  <button id="toggleChartBtn">Show/Hide Graph</button>
  <div id="chartContainer">
    <canvas id="trendChart"></canvas>
  </div>
</div>

<div class="main">
<h1>ðŸ’“ Heart Monitor Dashboard</h1>

<div class="gauges">
  <!-- BPM Gauge -->
  <div class="gauge-container">
    <div class="gauge-bg"></div>
    <div class="arc"><div class="arc-fill" id="bpmArc"></div></div>
    <div class="needle" id="bpmNeedle"></div>
    <div class="gauge-value" id="bpmValue">0</div>
    <div class="gauge-status" id="bpmStatus">--</div>
    <div class="gauge-time" id="bpmTime">--:--:--</div>
  </div>

  <!-- SpO2 Gauge -->
  <div class="gauge-container">
    <div class="gauge-bg"></div>
    <div class="arc"><div class="arc-fill" id="spo2Arc"></div></div>
    <div class="needle" id="spo2Needle"></div>
    <div class="gauge-value" id="spo2Value">0%</div>
    <div class="gauge-status" id="spo2Status">--</div>
    <div class="gauge-time" id="spo2Time">--:--:--</div>
  </div>
</div>

<div class="warning" id="warningText">Place your finger on the sensor</div>
</div>

<script>
// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyB8yZZHmjx4ExnkeV_V5iieSK5tSdY_Uqo",
    authDomain: "bpmhealth-813a8.firebaseapp.com",
    databaseURL: "https://bpmhealth-813a8-default-rtdb.firebaseio.com",
    projectId: "bpmhealth-813a8",
    storageBucket: "bpmhealth-813a8.firebasestorage.app",
    messagingSenderId: "503689688190",
    appId: "1:503689688190:web:2a5e729b1768088e46942f",
    measurementId: "G-99498TBNW5"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// DOM
const bpmValue = document.getElementById('bpmValue');
const spo2Value = document.getElementById('spo2Value');
const bpmStatus = document.getElementById('bpmStatus');
const spo2Status = document.getElementById('spo2Status');
const bpmNeedle = document.getElementById('bpmNeedle');
const spo2Needle = document.getElementById('spo2Needle');
const bpmTime = document.getElementById('bpmTime');
const spo2Time = document.getElementById('spo2Time');
const warningText = document.getElementById('warningText');
const bpmArc = document.getElementById('bpmArc');
const spo2Arc = document.getElementById('spo2Arc');

// Helper functions
function getBPMStatus(bpm){
    if(bpm===0) return {text:"No Finger",class:"low"};
    if(bpm<60) return {text:"Low",class:"low"};
    if(bpm<=100) return {text:"Normal",class:"normal"};
    return {text:"High",class:"high"};
}
function getSpO2Status(spo2){
    if(spo2===0) return {text:"No Finger",class:"low"};
    if(spo2<90) return {text:"Low",class:"low"};
    if(spo2<=100) return {text:"Normal",class:"normal"};
    return {text:"High",class:"high"};
}
function valueToAngle(value,max){return Math.min(Math.max((value/max)*240-120,-120),120);}
function arcAngle(value,max){ return (value/max)*240; }
function formatTime(date){ return date.toLocaleString();}

// Animate gauge
let currentBPMAngle = -120, currentSpO2Angle = -120;
function animateNeedle(needle,targetAngle,currentAngleRef){
    const diff=targetAngle-currentAngleRef.value;
    if(Math.abs(diff)<0.5) return;
    currentAngleRef.value+=diff*0.1;
    needle.style.transform=`rotate(${currentAngleRef.value}deg)`;
    requestAnimationFrame(()=>animateNeedle(needle,targetAngle,currentAngleRef));
}
function animateArc(arc,targetAngle){arc.style.transform=`rotate(${targetAngle-120}deg)`;}

// Chart setup
const ctx=document.getElementById('trendChart').getContext('2d');
const chartData={labels:[],datasets:[
    {label:'BPM',data:[],borderColor:'#00e676',tension:0.3,fill:false},
    {label:'SpOâ‚‚',data:[],borderColor:'#00b0ff',tension:0.3,fill:false}
]};
const trendChart=new Chart(ctx,{type:'line',data:chartData,options:{responsive:true,scales:{y:{min:0,max:150,ticks:{color:'#fff'}},x:{ticks:{color:'#fff'}}},plugins:{legend:{labels:{color:'#fff'}}}}});
function updateChart(bpm,spo2,timestamp){
    if(chartData.labels.length>30){
        chartData.labels.shift();
        chartData.datasets[0].data.shift();
        chartData.datasets[1].data.shift();
    }
    chartData.labels.push(timestamp);
    chartData.datasets[0].data.push(bpm);
    chartData.datasets[1].data.push(spo2);
    trendChart.update();
}

// Firebase listeners
db.ref('BPM').on('value',snapshot=>{
    const bpm = snapshot.val()||0;
    bpmValue.innerText=bpm;
    const status=getBPMStatus(bpm);
    bpmStatus.innerText=status.text;
    bpmStatus.className='gauge-status '+status.class;
    const targetAngle=valueToAngle(bpm,150);
    animateNeedle(bpmNeedle,targetAngle,{value:currentBPMAngle});
    currentBPMAngle=targetAngle;
    animateArc(bpmArc,arcAngle(bpm,150));
    const timestamp=formatTime(new Date());
    bpmTime.innerText=timestamp;
    warningText.style.display=(bpm===0)?'block':'none';
    const currentSpO2=parseInt(spo2Value.innerText)||0;
    updateChart(bpm,currentSpO2,timestamp);
});

db.ref('SpO2').on('value',snapshot=>{
    const spo2 = snapshot.val()||0;
    spo2Value.innerText=spo2+"%";
    const status=getSpO2Status(spo2);
    spo2Status.innerText=status.text;
    spo2Status.className='gauge-status '+status.class;
    const targetAngle=valueToAngle(spo2,100);
    animateNeedle(spo2Needle,targetAngle,{value:currentSpO2Angle});
    currentSpO2Angle=targetAngle;
    animateArc(spo2Arc,arcAngle(spo2,100));
    const timestamp=formatTime(new Date());
    spo2Time.innerText=timestamp;
    const currentBPM=parseInt(bpmValue.innerText)||0;
    updateChart(currentBPM,spo2,timestamp);
});

// Toggle chart panel
const toggleBtn=document.getElementById('toggleChartBtn');
const chartContainer=document.getElementById('chartContainer');
toggleBtn.addEventListener('click',()=>{chartContainer.style.display=(chartContainer.style.display==='none')?'block':'none';});
</script>

</body>
</html>

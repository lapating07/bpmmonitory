<!DOCTYPE html>
<html>
<head>
<title>Heart Monitor Dashboard</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap');

    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    h1 {
      color: #ff4081;
      margin-bottom: 30px;
    }

    .gauge-container {
      display: flex;
      justify-content: center;
      gap: 50px;
    }

    .gauge {
      position: relative;
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: conic-gradient(#00e676 0deg, #00e676 0deg, #444 0deg 360deg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Orbitron', monospace;
      font-size: 2em;
      color: #fff;
      box-shadow: 0 0 20px #000;
    }

    .gauge .status {
      position: absolute;
      bottom: 10px;
      font-size: 1em;
      font-weight: bold;
    }

    .low { color: #ff4444; }
    .normal { color: #00e676; }
    .high { color: #ffab00; }
    .warning { color: #ff4444; font-size: 1em; margin-top: 10px; }
</style>
</head>
<body>

<h1>ðŸ’“ Heart Monitor Dashboard</h1>

<div class="gauge-container">
  <div class="gauge" id="bpmGauge">
    <div id="bpmValue">0</div>
    <div class="status" id="bpmStatus">--</div>
  </div>
  <div class="gauge" id="spo2Gauge">
    <div id="spo2Value">0%</div>
    <div class="status" id="spo2Status">--</div>
  </div>
</div>

<div class="warning" id="warningText">Place your finger on the sensor</div>

<script>
    // Firebase configuration (Updated)
    const firebaseConfig = {
        apiKey: "AIzaSyB8yZZHmjx4ExnkeV_V5iieSK5tSdY_Uqo",
        authDomain: "bpmhealth-813a8.firebaseapp.com",
        databaseURL: "https://bpmhealth-813a8-default-rtdb.firebaseio.com",
        projectId: "bpmhealth-813a8",
        storageBucket: "bpmhealth-813a8.firebasestorage.app",
        messagingSenderId: "503689688190",
        appId: "1:503689688190:web:2a5e729b1768088e46942f",
        measurementId: "G-99498TBNW5"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // DOM elements
    const bpmValue = document.getElementById('bpmValue');
    const spo2Value = document.getElementById('spo2Value');
    const bpmStatus = document.getElementById('bpmStatus');
    const spo2Status = document.getElementById('spo2Status');
    const bpmGauge = document.getElementById('bpmGauge');
    const spo2Gauge = document.getElementById('spo2Gauge');
    const warningText = document.getElementById('warningText');

    // Helper functions
    function getBPMStatus(bpm) {
        if (bpm === 0) return { text: "No Finger", class: "low" };
        if (bpm < 60) return { text: "Low", class: "low" };
        if (bpm <= 100) return { text: "Normal", class: "normal" };
        return { text: "High", class: "high" };
    }

    function getSpO2Status(spo2) {
        if (spo2 === 0) return { text: "No Finger", class: "low" };
        if (spo2 < 90) return { text: "Low", class: "low" };
        if (spo2 <= 100) return { text: "Normal", class: "normal" };
        return { text: "High", class: "high" };
    }

    function updateGauge(gauge, value, max=150) {
        // value from 0 to max
        let angle = Math.min(value, max) / max * 360;
        gauge.style.background = `conic-gradient(#00e676 0deg, #00e676 ${angle}deg, #444 ${angle}deg 360deg)`;
    }

    // Listen for BPM
    db.ref('BPM').on('value', snapshot => {
        const bpm = snapshot.val() || 0;
        bpmValue.innerText = bpm;
        const status = getBPMStatus(bpm);
        bpmStatus.innerText = status.text;
        bpmStatus.className = 'status ' + status.class;

        updateGauge(bpmGauge, bpm, 150); // max BPM 150

        // Show warning if no finger
        warningText.style.display = (bpm === 0) ? 'block' : 'none';
    });

    // Listen for SpO2
    db.ref('SpO2').on('value', snapshot => {
        const spo2 = snapshot.val() || 0;
        spo2Value.innerText = spo2 + "%";
        const status = getSpO2Status(spo2);
        spo2Status.innerText = status.text;
        spo2Status.className = 'status ' + status.class;

        updateGauge(spo2Gauge, spo2, 100); // max SpO2 100
    });
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heart Rate & Blood Oxygen Records</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  background: #f5f7fa;
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 30px;
}
.chart-container {
  background: #fff;
  padding: 25px;
  border-radius: 12px;
  max-width: 1100px;
  margin: 30px auto;
}
table {
  width: 95%;
  max-width: 1100px;
  margin: 30px auto;
  border-collapse: collapse;
  background: #fff;
  border-radius: 12px;
}
th, td { padding: 12px; border-bottom: 1px solid #eee; }
th { background: #f0f0f0; }
tr.latest { background-color: #dff0d8; font-weight: bold; }
</style>
</head>
<body>

<h1>Heart Rate & Blood Oxygen Records</h1>

<h2>Graph</h2>
<div class="chart-container">
  <canvas id="recordsChart"></canvas>
</div>

<h2>Record Table</h2>
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Time</th>
      <th>BPM</th>
      <th>BPM Status</th>
      <th>SpO₂</th>
      <th>SpO₂ Status</th>
    </tr>
  </thead>
  <tbody id="historyTable"></tbody>
</table>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCOzEqHCKqOZG9pbROs1JJku19yN0S9zEI",
  authDomain: "dpmspo2.firebaseapp.com",
  databaseURL: "https://dpmspo2-default-rtdb.firebaseio.com",
  projectId: "dpmspo2",
  storageBucket: "dpmspo2.firebasestorage.app",
  messagingSenderId: "86512121446",
  appId: "1:86512121446:web:0bad04d8fa786db26f9fa7"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tableBody = document.getElementById("historyTable");

/* CHART */
const chart = new Chart(document.getElementById("recordsChart"), {
  type: 'line',
  data: {
    labels: [],
    datasets: [
      { label: "BPM", data: [], borderColor: "#f39c12", fill: false },
      { label: "SpO₂", data: [], borderColor: "#27ae60", fill: false }
    ]
  },
  options: {
    responsive: true,
    animation: false,
    scales: { y: { beginAtZero: true } }
  }
});

/* LOAD LAST 10 RECORDS */
function loadRecords() {
  db.ref("Records").orderByKey().limitToLast(10).once("value", snap => {
    const records = [];
    snap.forEach(child => {
      records.push(child.val());
    });
    records.reverse(); // newest first

    // UPDATE TABLE
    tableBody.innerHTML = "";
    records.forEach((record, index) => {
      const isLatest = index === 0 ? "latest" : "";
      tableBody.innerHTML += `
        <tr class="${isLatest}">
          <td>${record.date}</td>
          <td>${record.time}</td>
          <td>${record.BPM}</td>
          <td>${record.bpmStatus}</td>
          <td>${record.SpO2}</td>
          <td>${record.spo2Status}</td>
        </tr>`;
    });

    // UPDATE CHART
    chart.data.labels = records.map(r => r.time);
    chart.data.datasets[0].data = records.map(r => r.BPM);
    chart.data.datasets[1].data = records.map(r => r.SpO2);
    chart.update();
  });
}

/* AUTO-REFRESH EVERY SECOND */
setInterval(loadRecords, 1000);

/* INITIAL LOAD */
loadRecords();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Measurement History</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  background: #f5f7fa; 
  font-family: Arial; 
  padding: 25px; 
  text-align: center; 
  color: #333;
}

h1 { margin-bottom: 20px; }

.history-box {
  width: 95%;
  max-width: 1100px;
  background: white;
  margin: 20px auto;
  border-radius: 10px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.date-header {
  padding: 15px;
  background: #4a90e2;
  color: white;
  font-size: 1.2rem;
  text-align: left;
  cursor: pointer;
  border-radius: 10px 10px 0 0;
}

.table-container {
  display: none;
  padding: 10px 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
}

th { background: #eee; }
tr:hover { background: #f9f9f9; }

button {
  margin-top: 20px;
  padding: 10px 20px;
  background: #4a90e2; 
  border: none; 
  color: white;
  border-radius: 8px;
  cursor: pointer;
}
button:hover {
  background: #357ABD;
}
</style>
</head>
<body>

<h1>ðŸ“… Daily Measurement History</h1>

<a href="index.html"><button>â¬… Back to Dashboard</button></a>

<div id="historyContainer"></div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCOzEqHCKqOZG9pbROs1JJku19yN0S9zEI",
  authDomain: "dpmspo2.firebaseapp.com",
  databaseURL: "https://dpmspo2-default-rtdb.firebaseio.com",
  projectId: "dpmspo2",
  storageBucket: "dpmspo2.firebasestorage.app",
  messagingSenderId: "86512121446",
  appId: "1:86512121446:web:0bad04d8fa786db26f9fa7",
  measurementId: "G-GPDRFV8426"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const container = document.getElementById("historyContainer");

// Fetch ALL saved measurements
db.ref("Measurements").once("value", snapshot => {
  const data = snapshot.val();
  if (!data) {
    container.innerHTML = "<p>No history recorded yet.</p>";
    return;
  }

  // Group by date
  const grouped = {};

  Object.values(data).forEach(item => {
    if (!grouped[item.date]) grouped[item.date] = [];
    grouped[item.date].push(item);
  });

  // Create a collapsible section for each date
  Object.keys(grouped).sort().reverse().forEach(date => {
    const box = document.createElement("div");
    box.className = "history-box";

    const header = document.createElement("div");
    header.className = "date-header";
    header.innerHTML = "ðŸ“… " + date;

    const tableContainer = document.createElement("div");
    tableContainer.className = "table-container";

    // Table HTML
    let tableHTML = `
      <table>
        <thead>
          <tr>
            <th>Time</th>
            <th>BPM</th>
            <th>SpOâ‚‚ (%)</th>
          </tr>
        </thead>
        <tbody>
    `;

    grouped[date].forEach(entry => {
      tableHTML += `
        <tr>
          <td>${entry.time}</td>
          <td>${entry.BPM}</td>
          <td>${entry.SpO2}</td>
        </tr>
      `;
    });

    tableHTML += "</tbody></table>";
    tableContainer.innerHTML = tableHTML;

    // Toggle display on click
    header.onclick = () => {
      tableContainer.style.display =
        (tableContainer.style.display === "block") ? "none" : "block";
    };

    box.appendChild(header);
    box.appendChild(tableContainer);
    container.appendChild(box);
  });
});
</script>
</body>
</html>
